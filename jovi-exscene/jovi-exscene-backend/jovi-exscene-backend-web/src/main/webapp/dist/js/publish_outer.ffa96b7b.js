(function(e){function t(t){for(var i,r,o=t[0],l=t[1],c=t[2],d=0,p=[];d<o.length;d++)r=o[d],s[r]&&p.push(s[r][0]),s[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(p.length)p.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],i=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(i=!1)}i&&(n.splice(t--,1),e=r(r.s=a[0]))}return e}var i={},s={publish_outer:0},n=[];function r(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=i,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(a,i,function(t){return e[t]}.bind(null,i));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="../../dist/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;n.push([5,"chunk-vendors","chunk-common"]),a()})({"0ff5":function(e,t,a){},"2d2f":function(e,t,a){"use strict";var i=a("43ef"),s=a.n(i);s.a},"43ef":function(e,t,a){},"43f0":function(e,t,a){},4789:function(e,t,a){"use strict";var i=a("d1d2"),s=a.n(i);s.a},"4c0a":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var i=a("2b0e"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-container"},[a("div",{staticClass:"bread-crumb"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right bread-crumb"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[a("span",{on:{click:e.goHome}},[e._v("发布管理")])]),e.isAdd?a("el-breadcrumb-item",[e._v("发布新增")]):e._e(),e.isAdd||!e.isPublishShow||e.isDetailPage?e._e():a("el-breadcrumb-item",[e._v("发布编辑")]),!e.isAdd&&e.isDetailPage?a("el-breadcrumb-item",[e._v("发布详情")]):e._e()],1)],1),e.isTableShow&&!e.isCheckPage?a("add-component",{on:{"table-event":e.tableEvent}}):e._e(),e.isTableShow?a("header-component",{attrs:{"is-checkpage":e.isCheckPage},on:{"header-event":e.headerEvent}}):e._e(),e.isTableShow?a("table-component",{attrs:{"data-list":e.dataList,"is-checkpage":e.isCheckPage},on:{"table-event":e.tableEvent}}):e._e(),e.isTableShow?a("Pagination",{attrs:{"data-total":e.dataTotal,"current-page":e.pageIndex,"page-size":e.pageSize},on:{"footer-event":e.footerEvent}}):e._e(),e.isPublishShow?a("publish-Component",{attrs:{"is-add":e.isAdd,"type-data":e.typeList,"base-data":e.baseData,"is-detailpage":e.isDetailPage,"is-checkpage":e.isCheckPage},on:{"publish-event":e.publishEvent}}):e._e()],1)},n=[],r=(a("96cf"),a("3b8d")),o=(a("7f7f"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataList,border:"",height:"600"},on:{"sort-change":e.handleSortChange}},[a("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID","min-width":"80",sortable:"custom"}}),a("el-table-column",{attrs:{prop:"name",label:"卡片名称","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.goDetailPage(t.row)}}},[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{prop:"isReward",label:"是否抽奖","min-width":"80",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return a("span",{},[e._v(e._s(1===t.row.isReward?"是":"否"))])}}])}),a("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:"color: "+(e.statusObject[t.row.status]&&e.statusObject[t.row.status].color)},[e._v(e._s(e.statusObject[t.row.status]&&e.statusObject[t.row.status].name))])]}}])}),a("el-table-column",{attrs:{prop:"updateTime",label:"修改时间","min-width":"170",sortable:"custom"}}),a("el-table-column",{attrs:{prop:"modifyUserName",label:"修改人","min-width":"100"}}),a("el-table-column",{attrs:{prop:"expectedRelease",label:"预计发布量"},scopedSlots:e._u([{key:"default",fn:function(t){return a("span",{},[e._v(e._s(-1===t.row.expectedRelease?"无限制":t.row.expectedRelease))])}}])}),a("el-table-column",{attrs:{prop:"actualRelease",label:"实际发布量"}}),a("el-table-column",{attrs:{label:"操作","min-width":"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[[0,3,6].includes(t.row.status)?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.goEditPage(t.row)}}},[e._v("修改发布")]):e._e(),e._l(e.$store.state.publish.listActionOptions,function(i){return[e.statusObject[t.row.status]&&e.statusObject[t.row.status].allowActionKeys.includes(i.key)?a("el-button",{key:i.key,attrs:{size:"mini",type:i.style},on:{click:function(a){return e.actionsHandle(t.row,i.key,i.name)}}},[e._v(e._s(i.name))]):e._e()]})]}}])})],1),a("el-dialog",{attrs:{title:"导入",visible:e.isShowImport,width:"600px","before-close":e.importDialogClose,center:""},on:{"update:visible":function(t){e.isShowImport=t}}},[a("el-form",{ref:"excel",staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[a("el-form-item",{attrs:{label:""}},[a("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline-block",margin:"0 10px"},attrs:{action:"aaa","before-remove":e.removeFile,"http-request":e.getTranslationData,limit:1,"on-exceed":e.handleExceed}},[a("el-button",{attrs:{type:"primary"}},[e._v("选择文件")])],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.importDialogClose(!0)}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.importDialogClose()}}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"暂停申请",visible:e.zantingDialogVisible,width:"600px","before-close":e.zantingDialogClose,center:""},on:{"update:visible":function(t){e.zantingDialogVisible=t}}},[a("el-form",{ref:"zantingData",attrs:{model:e.zantingData,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"暂停原因",prop:"reason",rules:e.applyRules}},[a("el-input",{attrs:{autosize:{minRows:2,maxRows:3},type:"textarea",placeholder:"请填写暂停原因",maxlength:"100"},model:{value:e.zantingData.reason,callback:function(t){e.$set(e.zantingData,"reason",t)},expression:"zantingData.reason"}})],1)],1),a("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[e._v(e._s(e.zantingData.reason?e.zantingData.reason.length:0)+"/100")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.zantingDialogClose(!0)}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.zantingDialogClose()}}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"失效原因",visible:e.dialog.loseEffectiveness.visible,width:"600px","before-close":e.loseEffectivenessDialogClose,center:""},on:{"update:visible":function(t){return e.$set(e.dialog.loseEffectiveness,"visible",t)}}},[a("el-form",{ref:"loseeffectiveness",attrs:{model:e.dialog.loseEffectiveness.data,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"失效原因",prop:"reason",rules:e.applyRules}},[a("el-input",{attrs:{autosize:{minRows:2,maxRows:3},type:"textarea",placeholder:"请填写失效原因",maxlength:"100"},model:{value:e.dialog.loseEffectiveness.data.reason,callback:function(t){e.$set(e.dialog.loseEffectiveness.data,"reason",t)},expression:"dialog.loseEffectiveness.data.reason"}})],1)],1),a("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[e._v(e._s(e.dialog.loseEffectiveness.data.reason.length)+"/100")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.loseEffectivenessDialogClose(!0)}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.loseEffectivenessDialogClose()}}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"输入测试IMEI",visible:e.dialog.show.previewTest,width:"600px",center:""},on:{"update:visible":function(t){return e.$set(e.dialog.show,"previewTest",t)}}},[a("div",{staticClass:"test-dialog",staticStyle:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center","margin-top":"-30px"}},[a("span",[e._v("输入1-20个IMEI码")]),a("div",{staticStyle:{display:"flex",margin:"20px"}},[a("el-input",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{placeholder:"请输入IMEI",clearable:""},model:{value:e.imeiTestValue,callback:function(t){e.imeiTestValue=t},expression:"imeiTestValue"}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.saveIMEI()}}},[e._v("添加")])],1),a("div",{staticStyle:{display:"flex",width:"100%",padding:"10px 20px","flex-wrap":"wrap"}},e._l(e.imeiList,function(t,i){return a("el-tag",{key:i,staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{closable:"",type:"info"},on:{close:function(t){return e.deleteIMEI(i)}}},[e._v("\n          "+e._s(t)+"\n        ")])}),1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialog.show.previewTest=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.previewTest}},[e._v("确 定")])],1)])],1)}),l=[],c=(a("6762"),a("2fdb"),a("bd86")),u=a("ed08"),d={name:"table-component",props:{isCheckpage:{type:Boolean,default:!1},dataList:{type:Array,default:function(){return[]}}},data:function(){var e,t=function(e,t,a){/^\s+$/.test(t)?a(new Error("不能输入全空格")):a()};return e={questionnaireId:"",translationData:"",zantingDialogVisible:!1,zantingData:{},xiajiaDialogVisible:!1,xiajiaData:{},imeiList:[],imeiTestValue:"",imeiData:{grayscaleDataType:"",releaseType:""},actionTargetData:{cardId:"",classification:"",cardVersionCode:""},isShowImport:!1,dialog:{loseEffectiveness:{visible:!1,data:{id:"",versionCode:"",status:"",reason:""}},show:{previewTest:!1}}},Object(c["a"])(e,"imeiTestValue",""),Object(c["a"])(e,"imeiList",[]),Object(c["a"])(e,"applyRules",[{required:!0,message:"内容不能为空",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}]),e},computed:{statusObject:function(){return Object(u["arrOptionsToObject"])(this.$store.state.publish.statusOptions)},actionsObject:function(){return Object(u["arrOptionsToObject"])(this.$store.state.publish.listActionOptions)}},methods:{actionsHandle:function(e,t,a){var i=this;if(7===t)this.dialog.loseEffectiveness.data.id=e.id,this.dialog.loseEffectiveness.data.strategyId=e.strategyId,this.dialog.loseEffectiveness.data.status=t,this.dialog.loseEffectiveness.visible=!0;else{var s="是否确定".concat(a,"“").concat(e.name,"”?");this.$confirm(s,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(Object(r["a"])(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return-1===t&&(t=0===e.type?5:1===e.type?4:void 0),a.next=3,i.updateStatus(e.strategyId,t);case 3:case"end":return a.stop()}},a)}))).catch(function(){i.$message({type:"info",message:"已取消"})})}},goPreview:function(e){this.dialog.show.previewTest=!0,this.actionTargetData.cardId=e.bizId,this.actionTargetData.cardVersionCode=e.bizVersionCode,this.actionTargetData.classification=e.classification},updateStatus:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,a,i){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.publish.updateStatus({strategyId:t,status:a,failureReason:i});case 2:return s=e.sent,s&&(this.refreshData(),this.$message({type:"success",message:"操作成功!"})),e.abrupt("return",s);case 5:case"end":return e.stop()}},e,this)}));function t(t,a,i){return e.apply(this,arguments)}return t}(),saveIMEI:function(){if(this.imeiList.length>19)this.$confirm("只能输入1-20个IMEI","提示",{confirmButtonText:"确定",center:!0,type:"warning"});else if(this.imeiList.includes(this.imeiTestValue))this.$confirm("IMEI码重复！","提示",{confirmButtonText:"确定",center:!0,type:"warning"});else if(/^\d{15}$/.test(this.imeiTestValue)){if("865407010000009"===this.imeiTestValue||"123456789012345"===this.imeiTestValue)return this.$confirm("请检查添加的imei中是否存在非法imei码！","提示",{confirmButtonText:"确定",center:!0,type:"warning"}),!1;this.imeiList.push(this.imeiTestValue)}else this.$confirm("IMEI码不符合要求！(15位数字)","提示",{confirmButtonText:"确定",center:!0,type:"warning"})},deleteIMEI:function(e){this.imeiList.splice(e,1)},previewTest:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.imeiList.length<1)){e.next=3;break}return this.$confirm("请至少填入一个IMEI码","提示",{confirmButtonText:"确定",center:!0,type:"warning"}),e.abrupt("return",!1);case 3:return this.uploadLoading=!0,e.next=6,this.$api.publish.priviewTest({cardId:this.actionTargetData.cardId,cardVersionCode:this.actionTargetData.cardVersionCode,classification:this.actionTargetData.classification,imeis:this.imeiList.join(";")});case 6:t=e.sent,console.log("priviewTest",t),t&&(this.$message({type:"success",message:"预览推送成功!"}),this.uploadLoading=!1,this.dialog.show.previewTest=!1);case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleDelete:function(e){var t=this,a="是否确定删除“"+e.name+"”的草稿？";this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){var a={id:e.id,versionCode:e.versionCode};t.$http.post("/scene/del",a).then(function(e){e.data&&"0"==e.data.code?(t.refreshData(),t.$message({type:"success",message:"删除成功!"})):e.data.msg?t.$message.error(e.data.msg):t.$message.error("删除失败！")}).catch(function(){t.$message.error("删除失败！")})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},goDataPage:function(e){this.$emit("table-event",{type:"data-page",data:e})},goEditPage:function(e){0===e.status?this.$emit("table-event",{type:"add-page",data:e}):this.$emit("table-event",{type:"edit-page",data:e})},beforeUpload:function(e){},removeFile:function(e,t){console.log(1),this.translationData=""},handleExceed:function(){this.$message.error("只能导入一份文件，请先删掉当前文件!")},importTextTranslationData:function(e){console.log(e),this.isShowImport=!0,this.questionnaireId=e.bizId},getTranslationData:function(e){this.translationData=e.file,console.log(this.translationData)},downloadTextToExcel:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.publish.downloadTextToExcel({questionnaireId:t.bizId});case 2:a=e.sent,a&&this.downloadFile(a);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),downloadFile:function(e){var t=new Blob([e.data]);if("download"in document.createElement("a")){var a=document.createElement("a");a.style.display="none",a.href=URL.createObjectURL(t),a.download=decodeURIComponent(e.headers["filename"]),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}else navigator.msSaveBlob(t,fileName);this.$message.success("导出成功")},importDialogClose:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("function"!==typeof t){e.next=4;break}t(),e.next=20;break;case 4:if(!t){e.next=10;break}this.isShowImport=!1,this.translationData="",console.log(11),e.next=20;break;case 10:if(!this.translationData){e.next=17;break}return e.next=13,this.$api.publish.importTextTranslationData({questionnaireId:this.questionnaireId,importFile:this.translationData});case 13:a=e.sent,a&&(this.$message({type:"success",message:"导入成功"}),this.isShowImport=!1),e.next=20;break;case 17:return console.log(111111),this.$message.warning("请选择文件"),e.abrupt("return",!1);case 20:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),loseEffectivenessDialogClose:function(e){var t=this;"function"===typeof e?e():e?this.dialog.loseEffectiveness.visible=!1:this.$refs["loseeffectiveness"].validate(function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(a){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=7;break}return e.next=3,t.updateStatus(t.dialog.loseEffectiveness.data.strategyId,t.dialog.loseEffectiveness.data.status,t.dialog.loseEffectiveness.data.reason);case 3:i=e.sent,i&&(t.dialog.loseEffectiveness.visible=!1),e.next=9;break;case 7:return t.$message.warning("请按要求填写"),e.abrupt("return",!1);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},zantingDialogClose:function(e){var t=this;"function"===typeof e?(this.zantingData={},e()):e?(this.zantingData={},this.zantingDialogVisible=!1):this.$refs["zantingData"].validate(function(e){if(!e)return t.$message.warning("请按要求填写"),!1;var a={id:t.zantingData.id,versionCode:t.zantingData.versionCode,lastState:t.zantingData.status,status:-1,explain:t.zantingData.reason};t.$http.post("/scene/modifyState",a).then(function(e){e.data&&"0"==e.data.code?(t.refreshData(),t.$message({type:"success",message:"禁用成功"}),t.xiajiaData={},t.zantingDialogVisible=!1):e.data.msg?t.$message.error(e.data.msg):t.$message.error("禁用失败！")}).catch(function(){t.$message.error("禁用失败！")})})},zanting:function(e){this.zantingData=e,this.zantingDialogVisible=!0},xiajiaDialogClose:function(e){var t=this;"function"===typeof e?(this.xiajiaData={},e()):e?(this.xiajiaData={},this.xiajiaDialogVisible=!1):this.$refs["xiajiaData"].validate(function(e){if(!e)return t.$message.warning("请按要求填写"),!1;var a={id:t.xiajiaData.id,versionCode:t.xiajiaData.versionCode,lastState:t.xiajiaData.status,status:12,explain:t.xiajiaData.reason};t.$http.post("/scene/modifyState",a).then(function(e){e.data&&"0"==e.data.code?(t.refreshData(),t.$message({type:"success",message:"下架成功"}),t.xiajiaData={},t.xiajiaDialogVisible=!1):e.data.msg?t.$message.error(e.data.msg):t.$message.error("下架失败！")}).catch(function(){t.$message.error("下架失败！")})})},xiajia:function(e){this.xiajiaData=e,this.xiajiaDialogVisible=!0},shangjia:function(e){var t=this,a={id:e.id,versionCode:e.versionCode,lastState:e.status,status:9};this.$http.post("/scene/modifyState",a).then(function(e){e.data&&"0"==e.data.code?(t.refreshData(),t.$message({type:"success",message:"上架成功"})):e.data.msg?t.$message.error(e.data.msg):t.$message.error("上架失败！")}).catch(function(){t.$message.error("上架失败！")})},goDetailPage:function(e){this.$emit("table-event",{type:"detail-page",data:e})},goCheckPage:function(e){this.$emit("table-event",{type:"check-page",data:e})},refreshData:function(){this.$emit("table-event",{type:"refresh-data"})},handleSortChange:function(e){var t=e.prop,a="";"ascending"===e.order?a="asc":"descending"===e.order&&(a="desc"),this.$emit("table-event",{type:"sortChange",data:{field:t,order:a}})}}},p=d,h=(a("4789"),a("2877")),m=Object(h["a"])(p,o,l,!1,null,"64dfdd94",null),f=m.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"header-class"},[a("div",{staticClass:"left-input"},[a("el-input",{attrs:{placeholder:"卡片名称",clearable:""},on:{change:e.searchData},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e.isCheckpage?e._e():a("el-select",{staticClass:"left-select",attrs:{clearable:"",placeholder:"状态"},on:{change:e.searchData},model:{value:e.status.selectedKey,callback:function(t){e.$set(e.status,"selectedKey",t)},expression:"status.selectedKey"}},e._l(e.status.options,function(e){return a("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})}),1),a("el-button",{staticClass:"left-button",attrs:{icon:"el-icon-search",type:"primary"},on:{click:e.searchData}},[e._v("搜索")])],1)},b=[],v={name:"header-component",props:{isCheckpage:{type:Boolean,default:!1}},data:function(){return{name:"",isReward:"",status:{options:this.$store.state.publish.statusOptions,selectedKey:""}}},computed:{selectedCategorieKey:function(){var e=this,t=this.$store.state.cards.categorieOptions.filter(function(t){return!!t.options.filter(function(t){return t.key===e.cardCategorie.selectedSubKey}).length})[0];return t&&t.key}},mounted:function(){},methods:{searchData:function(){this.$emit("header-event",{type:"search-event",data:{name:this.name,isReward:this.isReward,status:this.status.selectedKey}})}}},y=v,w=(a("abe0"),Object(h["a"])(y,g,b,!1,null,"7bb732ef",null)),D=w.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-wrap"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addTips}},[e._v("发布新建")])],1)},_=[],k={methods:{addTips:function(){this.$emit("table-event",{type:"add-page",data:{name:this.tipsName,state:this.statusKey}})}}},C=k,T=(a("2d2f"),Object(h["a"])(C,x,_,!1,null,"7045964c",null)),R=T.exports,S=a("a920"),$=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.uploadLoading,expression:"uploadLoading"}],staticClass:"publish-container"},[a("div",{staticClass:"rules-area box-class"},[a("span",{staticClass:"title-class"},[e._v("发布选择")]),e.isAdd?a("el-form",{ref:"serviceData",attrs:{"label-position":"left",model:e.serviceData,rules:e.serviceRule,"label-width":"150px",size:"small"}},[0===e.baseData.status?a("el-form-item",{attrs:{label:"卡片: "}},[e._v("\n        "+e._s(e.baseData.name)+"\n      ")]):a("el-form-item",{attrs:{label:"选择卡片：",prop:"strategyId"}},[a("el-select",{attrs:{placeholder:"请选择卡片"},on:{change:e.cardsChange},model:{value:e.serviceData.strategyId,callback:function(t){e.$set(e.serviceData,"strategyId",t)},expression:"serviceData.strategyId"}},e._l(e.typeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.strategyId}})}),1)],1),e.downloadFileUrl?a("el-form-item",{attrs:{label:"导入翻译文本：",prop:"file"}},[a("a",{attrs:{href:e.downloadFileUrl,target:"_blank"}},[e._v("\n            "+e._s(e.downloadFileName)+"\n          ")])]):e._e(),a("el-form-item",{attrs:{label:"智慧场景版本：",prop:"intelligSceneEdition"}},[a("div",[a("el-checkbox-group",{model:{value:e.serviceData.intelligSceneEdition,callback:function(t){e.$set(e.serviceData,"intelligSceneEdition",t)},expression:"serviceData.intelligSceneEdition"}},e._l(e.versionList,function(t,i){return a("el-checkbox",{key:i,attrs:{label:t}},[e._v("\n              "+e._s(t)+"\n            ")])}),1)],1),a("div",{staticClass:"tips"},[e._v("（可勾选的场景版本需要找服务器配置，请联系陆国栋）")])])],1):a("el-form",{attrs:{"label-position":"left",model:e.serviceData,"label-width":"150px",size:"small"}},[a("el-form-item",{attrs:{label:"卡片: "}},[e._v("\n        "+e._s(e.baseData.name)+"\n      ")]),e.downloadFileName?a("el-form-item",{attrs:{label:"导入翻译文本："}},[a("div",[a("a",{attrs:{href:e.downloadFileUrl,target:"_blank"}},[e._v("\n            "+e._s(e.downloadFileName)+"\n          ")])])]):e._e(),0!==e.baseData.status?a("el-form-item",{attrs:{label:"智慧场景版本："}},[a("span",[e._v(e._s(e.intelligSceneEdition))])]):e._e()],1)],1),e.isDetailpage?[a("div",{staticClass:"rules-area box-class"},[a("span",{staticClass:"title-class"},[e._v("发布策略")]),a("el-form",{ref:"imeiData",staticClass:"my-form",attrs:{"label-position":"left",model:e.imeiData,"label-width":"150px",size:"small"}},[a("el-form-item",{attrs:{label:"发布方式：",prop:"type"}},[0===e.imeiData.type?a("div",[e._v("全量发布")]):e._e(),1===e.imeiData.type?a("div",[e._v("灰度发布")]):e._e()]),a("el-form-item",{attrs:{label:"发布量：",prop:"release"}},[a("div",[e._v("预设发布量："+e._s(-1===e.imeiData.expectRelease?"无限制":e.imeiData.expectRelease))]),a("div",[e._v("实时发布量："+e._s(e.imeiData.realRelease))])])],1)],1),a("div",{staticClass:"notice-area box-class"},[a("span",{staticClass:"title-class"},[e._v("审核进度")]),0===e.bohuiReason.approvalTestStatus?a("div",{staticClass:"check-div"},[a("i",{staticClass:"el-icon-remove",staticStyle:{color:"#909399"}}),e._v("测试人员未审核")]):e._e(),1===e.bohuiReason.approvalTestStatus?a("div",{staticClass:"check-div"},[a("i",{staticClass:"el-icon-success",staticStyle:{color:"#409EFF"}}),e._v("测试人员审核：测试工程师"+e._s(e.bohuiReason.approvalTestUserName)+"审核通过")]):e._e(),2===e.bohuiReason.approvalTestStatus?a("div",{staticClass:"check-div"},[a("i",{staticClass:"el-icon-error",staticStyle:{color:"#f56c6c"}}),e._v("测试人员审核：测试工程师"+e._s(e.bohuiReason.approvalTestUserName)+"审核不通过原因为："+e._s(e.bohuiReason.approvalTestReason))]):e._e(),0===e.bohuiReason.approvalOperationStatus?a("div",{staticClass:"check-div"},[a("i",{staticClass:"el-icon-remove",staticStyle:{color:"#909399"}}),e._v("运营人员未审核")]):e._e(),1===e.bohuiReason.approvalOperationStatus?a("div",{staticClass:"check-div"},[a("i",{staticClass:"el-icon-success",staticStyle:{color:"#409EFF"}}),e._v("运营人员审核：运营经理"+e._s(e.bohuiReason.approvalOperationUserName)+"审核通过")]):e._e(),2===e.bohuiReason.approvalOperationStatus?a("div",{staticClass:"check-div"},[a("i",{staticClass:"el-icon-error",staticStyle:{color:"#f56c6c"}}),e._v("运营人员审核：运营经理"+e._s(e.bohuiReason.approvalOperationUserName)+"审核不通过原因为："+e._s(e.bohuiReason.approvalOperationReason))]):e._e()]),e.failReason?a("div",{staticClass:"box-class"},[a("div",{staticClass:"reason-area"},[a("div",{staticStyle:{"font-size":"19px","font-weight":"bold","margin-bottom":"10px"}},[e._v("失效原因")]),a("div",[e._v(e._s(e.failReason))])])]):e._e(),a("div",{staticClass:"buttons-area box-class"},[1===e.stepNumber?a("el-button",{staticClass:"button-class",attrs:{type:"primary",round:""},on:{click:function(t){return e.goHome()}}},[e._v("返回")]):e._e()],1)]:[a("div",{staticClass:"rules-area box-class"},[a("span",{staticClass:"title-class"},[e._v("发布策略")]),a("el-form",{ref:"imeiData",staticClass:"my-form",attrs:{"label-position":"left",model:e.imeiData,rules:e.imeiRules,"label-width":"150px",size:"small"}},[a("el-form-item",{attrs:{label:"发布方式：",prop:"type"}},[a("el-radio-group",{model:{value:e.imeiData.type,callback:function(t){e.$set(e.imeiData,"type",t)},expression:"imeiData.type"}},[a("el-radio",{attrs:{label:0}},[e._v("全量发布")]),a("el-radio",{attrs:{label:1}},[e._v("灰度发布")])],1)],1),a("el-form-item",{attrs:{label:"发布量：",prop:"release"}},[a("el-radio-group",{model:{value:e.imeiData.releaseType,callback:function(t){e.$set(e.imeiData,"releaseType",t)},expression:"imeiData.releaseType"}},[a("el-radio",{attrs:{label:0}},[e._v("无限制")]),a("el-radio",{attrs:{label:1}},[e._v("预设发布量")])],1)],1),1===e.imeiData.releaseType?a("el-form-item",{attrs:{label:"",prop:"expectRelease"}},[a("el-input",{attrs:{placeholder:"填写1~999999999999的整数"},model:{value:e.imeiData.expectRelease,callback:function(t){e.$set(e.imeiData,"expectRelease",t)},expression:"imeiData.expectRelease"}})],1):e._e(),1===e.imeiData.type?[a("el-form-item",{attrs:{label:"",required:""}},[a("span",{staticClass:"tips"},[e._v("\n              （内部测试请填数字10并安装测试apk，下载地址：\n              "),a("a",{attrs:{href:"http://assistant-trip-static.vivo.com.cn/scene/Survey/Survey.apk"}},[e._v("测试apk")]),e._v("）\n            ")])])]:e._e()],2)],1),a("div",{staticClass:"buttons-area box-class"},[1===e.stepNumber?a("el-button",{staticClass:"button-class",attrs:{type:"primary",round:""},on:{click:function(t){return e.cancelEditButton()}}},[e._v("取消编辑")]):e._e(),1===e.stepNumber?a("el-button",{staticClass:"button-class",attrs:{type:"primary",round:""},on:{click:function(t){return e.saveButton()}}},[e._v("提交审核")]):e._e()],1)]],2)},E=[],I=a("e814"),O=a.n(I),j=(a("28a5"),a("a481"),a("c5f6"),a("e2e9"),a("7026")),P=a.n(j),z=(a("542c"),{name:"publish-component",components:{Treeselect:P.a},props:{isCheckpage:{type:Boolean,default:!1},isAdd:{type:Boolean,default:!1},isDetailpage:{type:Boolean,default:!1},typeData:{},versionData:{},baseData:{}},data:function(){var e=function(e,t,a){/^\s+$/.test(t)?a(new Error("不能输入全空格")):a()};return{serviceData:{strategyId:"",intelligSceneEdition:[],bizId:""},status:"",roleList:[],roleValue:"",downloadFileName:"",downloadFileUrl:"",excelFileName:"",excelFile:"",intelligSceneEdition:"",typeList:[],versionList:[],uploadLoading:!1,greyType:1,imeiList:[],imeiValue:"",imeiData:{grayscaleDataType:"",roleGrey:[],type:1,clientVersion:"0",greyTypeList:[],expectRelease:1,realRelease:0,releaseType:1},release:{real:0,expect:0,type:0},startTimeDisabled:!1,testCardUrl:"",isExam:!1,xiajiaDialogVisible:!1,jinyongDialogVisible:!1,isEditPage:!0,examDialogVisible:!1,testImgSrc:"",testDialogVisible:!1,bohuiReason:{},failReason:"",failureReason:"",cardPreview:"",expandPreview:"",stepNumber:1,weightData:{order:"",attenuationDuration:""},serviceRule:{strategyId:[{required:!0,message:"请选择卡片",trigger:"change"}],intelligSceneEdition:[{required:!0,message:"请选择版本",trigger:"change"}]},imeiRules:{clientVersion:[{required:!0,message:"请输入最低版本号",trigger:"blur"},{type:"string",pattern:/^[0-9]*$/,message:"版本号需为整数",trigger:"blur"},{min:5,max:10,message:"请输入5~10位的整数",trigger:"change"},{min:5,max:10,message:"请输入5~10位的整数",trigger:"blur"}],type:[{required:!0,message:"请选择发布方式",trigger:"change"}],greyTypeList:[{required:!0,message:"请选择控制方式",trigger:"change"}],imeiGreyType:[{required:!0,message:"请选择定向灰度",trigger:"change"}],expectRelease:[{required:!0,message:"请输入预设发布量"},{pattern:/^[1-9]\d{0,11}$/,message:"请输入不大于999999999999的正整数"}]},applyRules:[{required:!0,message:"内容不能为空",trigger:"blur"},{required:!0,validator:e,trigger:"blur"}]}},watch:{"imeiData.releaseType":function(e){this.imeiData.expectRelease=0===e?-1:-1===this.imeiData.expectRelease?1:this.imeiData.expectRelease}},created:function(){this.getPublishExamine()},mounted:function(){this.getEdition(),this.isCheckpage||this.isDetailpage,"undefined"!==typeof this.baseData.id&&this.getDataXhr()},methods:{cardsChange:function(e){for(var t=0;t<this.typeList.length;t++)this.typeList[t].strategyId===e&&(this.downloadFileName=this.typeList[t].fileName,this.downloadFileUrl=this.typeList[t].fileUrl);console.log(e)},number:function(){this.roleValue=this.roleValue.replace(/[^\.\d]/g,""),this.roleValue=this.roleValue.replace(".","")},saveRole:function(){this.roleValue>10||this.roleValue<0||""==this.roleValue?this.$confirm("role发布需为0-10之间的整数","提示",{confirmButtonText:"确定",center:!0,type:"warning"}):this.roleList.includes(this.roleValue)?this.$confirm("role发布重复！","提示",{confirmButtonText:"确定",center:!0,type:"warning"}):(this.roleList.push(this.roleValue),this.roleValue="")},deleteRole:function(e){this.roleList.splice(e,1)},handleExceed:function(){this.$message.warning("一次只能上传一个文件，请先删掉当前文件")},removeFile:function(){this.excelFile="",this.excelFileName=""},getExcelFile:function(e){this.excelFile=e.file,this.excelFileName=e.file.name},goDataPage:function(){this.$emit("publish-event",{type:"data-page"})},goHome:function(){this.$emit("publish-event",{type:"home-page"})},isEmpty:function(e){return"undefined"===typeof e||""===e||null===e},dataCheck:function(e){var t=!1;return console.log(this.serviceData.strategyId),this.isAdd&&this.$refs["serviceData"].validate(function(e){t=e}),this.$refs["imeiData"].validate(function(e){t=e}),console.log(),t},saveButton:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.dataCheck()){e.next=2;break}return e.abrupt("return",!1);case 2:if(!this.excelFile){e.next=9;break}return e.next=5,this.$api.publish.uploadTranslateFile({file:this.excelFile});case 5:if(t=e.sent,t){e.next=8;break}return e.abrupt("return");case 8:this.downloadFileUrl=t.fileUrl;case 9:return this.uploadLoading=!0,a={},a={strategyId:this.serviceData.strategyId,intelligSceneEdition:this.serviceData.intelligSceneEdition.join(",")||this.intelligSceneEdition,clientVersion:this.imeiData.clientVersion,type:this.imeiData.type,roleGrey:0===this.imeiData.type?0:10,expectedRelease:Number(this.imeiData.expectRelease),fileUrl:this.downloadFileUrl,fileName:this.excelFileName},console.log(a),e.next=15,this.$api.publish.publish(a);case 15:i=e.sent,this.uploadLoading=!1,i&&(this.isAdd?this.$message({showClose:!0,message:"创建成功",type:"success"}):this.$message({showClose:!0,message:"修改成功",type:"success"}),this.goHome());case 18:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),cancelEditButton:function(){var e=this;this.$confirm("是否确定取消编辑?","提示",{confirmButtonText:"确定",cancelButtonText:"返回",type:"warning",center:!0}).then(function(){e.$emit("publish-event",{type:"home-page"})}).catch(function(){})},getDataXhr:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log(this.baseData.strategyId),t={strategyId:this.baseData.strategyId},e.next=4,this.$api.publish.getPublishDetail(t);case 4:a=e.sent,console.log(a),a&&(i=a,this.serviceData.strategyId=i.strategyId,this.serviceData.name=i.name,this.serviceData.bizId=i.bizId,this.status=a.status,this.baseData.intelligSceneEdition=i.intelligSceneEdition,i.intelligSceneEdition&&(this.intelligSceneEdition=i.intelligSceneEdition.join(", ")),this.imeiData.type=i.type,i.roleGrey&&(this.imeiData.roleGrey=i.roleGrey.split(","),this.roleList=this.imeiData.roleGrey),this.failReason=i.failureReason,this.downloadFileUrl=i.fileUrl,this.downloadFileName=i.fileName,console.log("downloadFileUrl",this.excelFileName),this.bohuiReason.approvalTestReason=i.approvalTestReason,this.bohuiReason.approvalOperationReason=i.approvalOperationReason,this.bohuiReason.approvalTestUserName=i.approvalTestUserName,this.bohuiReason.approvalOperationUserName=i.approvalOperationUserName,this.bohuiReason.approvalOperationStatus=i.approvalOperationStatus,this.bohuiReason.approvalTestStatus=i.approvalTestStatus,console.log(this.bohuiReason),this.imeiData.imeiGreyType=i.imeiGreyType&&O()(i.imeiGreyType),this.imeiData.clientVersion=String(i.clientVersion),this.imeiData.greyTypeList=i.greyType?i.greyType.split(",").map(Number):[],this.imeiData.imeiDefineTypeList=i.imeiDefineType?i.imeiDefineType.split(",").map(Number):[],this.imeiData.releaseType=-1===i.expectedRelease?0:1,this.imeiData.realRelease=i.actualRelease,this.imeiData.expectRelease=i.expectedRelease);case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getEdition:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.publish.getEdition();case 2:t=e.sent,this.versionList=t;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getPublishExamine:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.publish.getPublishExamine();case 2:t=e.sent,this.typeList=t;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}}),L=z,V=(a("de03"),a("8882"),Object(h["a"])(L,$,E,!1,null,"23dc0dc1",null)),F=V.exports,N={name:"app",components:{addComponent:R,tableComponent:f,headerComponent:D,Pagination:S["a"],publishComponent:F},data:function(){return{isPublishShow:!1,isDetailPage:!1,isTableShow:!0,isCheckPage:!1,isAdd:!1,typeList:[],dataList:[],pageIndex:1,pageSize:20,dataTotal:0,name:"",isReward:"",searchState:"",searchField:"",searchOrder:"",baseData:{}}},methods:{publishEvent:function(e){switch(e.type){case"home-page":this.goHome();break;case"data-page":break;default:break}},goHome:function(){this.getDataXhr(),this.isPublishShow=!1,this.isAdd=!1,this.isCheckPage=!1,this.isDetailPage=!1,this.isTableShow=!0},tableEvent:function(e){switch(e.type){case"data-page":break;case"add-page":this.baseData=e.data,this.isTableShow=!1,this.isAdd=!0,this.isDetailPage=!1,this.isCheckPage=!1,this.isPublishShow=!0;break;case"edit-page":this.baseData=e.data,this.isAdd=!1,this.isTableShow=!1,this.isDetailPage=!1,this.isCheckPage=!1,this.isPublishShow=!0;break;case"detail-page":console.log(e.data),this.baseData=e.data,this.isTableShow=!1,this.isAdd=!1,this.isDetailPage=!0,this.isCheckPage=!1,this.isPublishShow=!0;break;case"check-page":this.baseData=e.data,this.isAdd=!1,this.isTableShow=!1,this.isDetailPage=!1,this.isCheckPage=!0,this.isPublishShow=!0;break;case"refresh-data":this.getDataXhr();break;case"sortChange":this.searchOrder=e.data.order,this.searchField=e.data.field,this.getDataXhr();break;default:break}},headerEvent:function(e){this.searchData(e.data)},searchData:function(e){this.name=e.name,this.isReward=e.isReward,this.isCheckPage?this.searchState=3:this.searchState=e.status,this.pageIndex=1,this.getDataXhr()},getDataXhr:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={name:""===this.name?void 0:this.name,status:""===this.searchState?void 0:this.searchState,isReward:""===this.isReward?void 0:this.isReward,field:""===this.searchField?void 0:this.searchField,order:""===this.searchOrder?void 0:this.searchOrder,page:this.pageIndex,size:this.pageSize},e.next=3,this.$api.publish.getPublishList(t);case 3:a=e.sent,a&&(this.dataTotal=a.totalElements,this.dataList=a.content);case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getTypeList:function(){var e=this;this.$http.post("/scene/getPublishExamine",{}).then(function(t){e.typeList=t.data.data&&t.data.data}).catch(function(){})},footerEvent:function(e){switch(e.type){case"pageChange":this.pageIndex=e.data,this.getDataXhr();break;case"sizeChange":this.pageIndex=1,this.pageSize=e.data,this.getDataXhr();break;default:break}}},created:function(){this.getDataXhr()}},U=N,A=(a("6e81"),Object(h["a"])(U,s,n,!1,null,"63e86790",null)),B=A.exports,q=a("2f62"),K=a("89c8"),M={namespaced:!0,state:{statusOptions:[{key:0,name:"待发布",color:"orange",allowActionKeys:[]},{key:1,name:"发布审核",color:"blue",allowActionKeys:[]},{key:2,name:"待启动",color:"Orange",allowActionKeys:[-1]},{key:3,name:"驳回",color:"black",allowActionKeys:[]},{key:4,name:"灰度",color:"green",allowActionKeys:[7,6]},{key:5,name:"全量发布",color:"green",allowActionKeys:[7,6]},{key:6,name:"暂停中",color:"black",allowActionKeys:[7,-1]},{key:7,name:"已失效",color:"black",allowActionKeys:[]}],categorieOptions:[],listActionOptions:[{key:7,name:"失效",style:"primary"},{key:6,name:"暂停",style:"warning"},{key:-1,name:"启动",style:"success"}]},mutations:{SET_CATEGORIE_OPTIONS:function(e,t){e.categorieOptions=t}},actions:{}},G=M;i["default"].use(q["a"]);var X=new q["a"].Store({modules:{publish:G}}),H=X,J=a("5c96"),Q=a.n(J);a("0fae");i["default"].use(Q.a),i["default"].use(K["a"]),i["default"].config.productionTip=!1,new i["default"]({store:H,render:function(e){return e(B)}}).$mount("#app")},5:function(e,t,a){e.exports=a("4c0a")},"6e81":function(e,t,a){"use strict";var i=a("43f0"),s=a.n(i);s.a},8882:function(e,t,a){"use strict";var i=a("90a2"),s=a.n(i);s.a},"90a2":function(e,t,a){},abe0:function(e,t,a){"use strict";var i=a("cb60"),s=a.n(i);s.a},cb60:function(e,t,a){},d1d2:function(e,t,a){},de03:function(e,t,a){"use strict";var i=a("0ff5"),s=a.n(i);s.a}});